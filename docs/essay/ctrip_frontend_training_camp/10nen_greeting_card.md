---
title: 十年贺卡（微信小程序）
tag:
  - essay
  - miniProgram
  - trainingCamp
date: 2024-02-26
---

## 动机

自从我们第一次见面已经过去了十年，最近恰好听到了 `奥華子` 的 `10年` 这首歌，深受感动，遂有此意。

## 任务拆解

1. 初步的封面和卡片布局，包含封面的上滑动画

   封面布局：音乐歌词在底部，当前日期和时间在上方

   卡片布局：正方形专辑封面在上方，祝福信息在下方

1. 为封面和卡片设置背景图像，包括上下滑动时封面透明度和模糊动画

1. 为发送的信息创建输入框，并绑定到数据

1. 分享配置，用于祝福信息、接收者姓名的URL查询字符串

1. 为不同的用户显示不同的内容，包括分享按钮和文本框显示效果

1. 添加音乐 `10年` 及其歌词到封面中（后注：歌词因为显示位置问题，不会实现）

1. 歌词动画？如何实现？（后注：不会做这个，太复杂且性能低）

1. 分享按钮显示效果改进，在更多信息按钮中移动（位于底部中心布局）

## 难点

::: warning 动画卡顿问题
因为 touchmove 时间频繁触发，会导致动画卡顿，因此采用节流来尝试解决，但因此产生了动画被打断的问题

```
->                           touchstart
  ----------------->         touchmove
    --> --> --> --> -->      throttle of touchmove handler
                    ->       touchend
```

当 touchend 时间触发时，有可能 touchmove 的事件由于节流定时器的原因还没有执行完，导致收尾的动画被打断，因此加入一个状态变量 `stillTouch` 来检测，如果 touchend 发生，就会将变量置为 false，而此时 touchmove 的处理程序便不会执行
:::

::: warning 素材体积过大
图片和音频体积都过大，超过了 200kb 的限制，因此需要对图片进行压缩，音频进行转码，但这还不够，后面选择让所有图标和字体通过 CDN 来加载，音频我处理后上传到了自己的云服务器，通过服务器来获取，至于背景图片还是本地引入
:::

## 问题

- 需求未制定，仅给出了任务的分布拆解，导致后续需求变更时需要重新修改代码（如歌词动画的需求）
- 微信小程序的开发工具链支持不完善，缺少一些常见的功能，如代码格式化，重命名等，可能导致代码质量不高
- 语法和正常浏览器有很多差异，可能出现了很多冗余的写法
- 祝福语直接使用了 input 组件，无法输入多行文本

## 感谢

- [`落霞文楷`](https://github.com/lxgw/LxgwWenKai) 字体
- <a href="https://icons8.com">Icons8</a> 提供的 <a  href="https://icons8.com/icon/25603/circled-play">Circled Play</a> 等 SVG 图标
