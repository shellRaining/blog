---
title: HTTPS 细节
tag:
  - net
  - interview_question
date: 2024-03-13
---

## HTTPS 是什么

可以简单理解为 HTTP + SSL/TLS，即在 HTTP 的基础上加入了 SSL/TLS 协议，用于对数据进行加密传输。

出现这个是因为 HTTP 协议本身有很多安全方面的漏洞，比如：

- 通信使用明文（不加密），内容可能被窃听
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明报文的完整性，所以有可能被篡改

而 SSL/TLS 协议是为了解决这些问题而设计的，HTTP 首先和 SSL 进行通信，再转交由 TCP 进行通信。

## SSL/TLS 协议

该协议使用了混合加密技术，通过非对称加密算法来交换对称加密算法的密钥，然后使用对称加密算法来加密通信内容。

为了解决上面提到的第一个问题，我们使用对称加密算法来加密通信内容，这样即使被窃听，也无法解密。

为了解决第二个问题（对外暴露的公钥的归属是否是我们想访问网页的服务器），我们使用 CA 证书来验证通信方的身份，这样可以避免伪装。

为了解决第三个问题，我们使用数字签名来验证报文的完整性，这样可以避免篡改。

整个过程大致如下

1. 用户向服务器发送请求
1. 服务器将自己公钥随同权威机构颁发的数字证书一起发送给用户
1. 用户收到证书后，会使用浏览器内置的权威机构的公钥来解密证书，然后验证证书是否由可信机构颁发，是否过期，是否与域名一致等。如果验证不通过，会弹出警告框，由用户选择是否继续通信
1. 如果验证通过，用户会生成一个随机码 KEY，并使用服务器的公钥来加密这个随机码，然后发送给服务器
1. 服务器收到 KEY 后，使用自己的私钥来解密 KEY，然后使用 KEY 来加密通信内容，发送给用户，双方开始通信

顺便一提，HTTPS 的默认端口是 443，而 HTTP 的默认端口是 80。
